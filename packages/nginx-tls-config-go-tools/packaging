set -eu

export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export PATH=$GOROOT/bin:$PATH
export GOPATH=${BOSH_COMPILE_TARGET}/nginx-tls-config-go-tools

mkdir -p ${BOSH_INSTALL_TARGET}/bin

# Rename vendor to src so that we can use the parent dir as a GOPATH
ln -s ${BOSH_COMPILE_TARGET}/nginx-tls-config-go-tools/vendor ${BOSH_COMPILE_TARGET}/nginx-tls-config-go-tools/src

go build -o ${BOSH_INSTALL_TARGET}/bin/gen-nginx-config ${BOSH_COMPILE_TARGET}/nginx-tls-config-go-tools/cmd/gen-nginx-conf/gen_nginx_config.go
go build -o ${BOSH_INSTALL_TARGET}/bin/le-responder     ${BOSH_COMPILE_TARGET}/nginx-tls-config-go-tools/cmd/le-responder/le_responder.go
