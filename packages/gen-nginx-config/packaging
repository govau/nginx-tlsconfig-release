set -eu

export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export PATH=$GOROOT/bin:$PATH
export GOPATH=${BOSH_COMPILE_TARGET}/gen-nginx-config

mkdir -p ${BOSH_INSTALL_TARGET}/bin

# Rename vendor to src so that we can use the parent dir as a GOPATH
ln -s ${BOSH_COMPILE_TARGET}/gen-nginx-config/vendor ${BOSH_COMPILE_TARGET}/gen-nginx-config/src
go build -o ${BOSH_INSTALL_TARGET}/bin/gen-nginx-config ${BOSH_COMPILE_TARGET}/gen-nginx-config/main.go
